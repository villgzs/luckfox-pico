H√°l√≥zati fel√©p√≠t√©sem a k√∂vetkez≈ë: internet - (fix ip)router(192.168.0.x/24) - bels≈ë h√°l√≥zat. A bels≈ë h√°l√≥zaton van a 2-es c√≠men egy ubuntu, amellyel wireguard tunnelt lehet ki√©p√≠teni ( a router forward m√≥don √°tk√ºldi az UDP csomagot a 2-es c√≠mre. Azt szeretn√©m el√©rni, hogy a bels≈ë h√°l√≥zaton lev≈ë eszk√∂z√∂k webes lapjait el tudjam √©rni a tunnel-en kereszt√ºl. A tunnel a 10.0.0.x/24 h√°l√≥zatot adja.
                                                                                                                                                                                        
                                                                                                                                                                                        A c√©lod r√∂viden:
a WireGuard tunnel (10.0.0.0/24) fel≈ël el szeretn√©d √©rni a bels≈ë LAN (192.168.0.0/24) eszk√∂zeinek webes fel√ºlet√©t.

A topol√≥gi√°d:
                                                                                                                                                                                                                                                                                                                                                                             
Internet
   |
[Router - 192.168.0.1]
   |
LAN 192.168.0.0/24
   |
[Ubuntu - 192.168.0.2]
   |
WireGuard tunnel
10.0.0.0/24
                                                                                                                                                                                        
                      A router m√°r forwardolja az UDP-t az Ubuntu (192.168.0.2) fel√© ‚Äì ez rendben van.

‚úÖ Mit kell be√°ll√≠tani?
1Ô∏è‚É£ IP forwarding enged√©lyez√©se az Ubuntu-n

Az Ubuntu-n:

sudo sysctl -w net.ipv4.ip_forward=1

Tart√≥san:

sudo nano /etc/sysctl.conf

Add hozz√°:

net.ipv4.ip_forward=1

Majd:

sudo sysctl -p


2Ô∏è‚É£ WireGuard szerver konfigur√°ci√≥

P√©lda /etc/wireguard/wg0.conf:

[Interface]
Address = 10.0.0.1/24
PrivateKey = SERVER_PRIVATE_KEY
PostUp = iptables -A FORWARD -i wg0 -o eth0 -j ACCEPT
PostUp = iptables -A FORWARD -i eth0 -o wg0 -m state --state RELATED,ESTABLISHED -j ACCEPT
PostUp = iptables -t nat -A POSTROUTING -s 10.0.0.0/24 -o eth0 -j MASQUERADE

PostDown = iptables -D FORWARD -i wg0 -o eth0 -j ACCEPT
PostDown = iptables -D FORWARD -i eth0 -o wg0 -m state --state RELATED,ESTABLISHED -j ACCEPT
PostDown = iptables -t nat -D POSTROUTING -s 10.0.0.0/24 -o eth0 -j MASQUERADE

‚ö†Ô∏è Ha az interf√©sz neve nem eth0 (pl. ens18), akkor azt haszn√°ld.

3Ô∏è‚É£ A kliens oldalon

A kliens WireGuard configban:

[Peer]
PublicKey = SERVER_PUBLIC_KEY
Endpoint = FIX_IP:51820
AllowedIPs = 192.168.0.0/24, 10.0.0.0/24

Ez nagyon fontos:

AllowedIPs = 192.168.0.0/24

k√ºl√∂nben nem fogja a LAN fel√© k√ºldeni a forgalmat.

üîÅ Mi t√∂rt√©nik ilyenkor?

A kliens 192.168.0.x c√≠mre k√ºld csomagot

A WireGuard tunnel-en √°tmegy az Ubuntu szerverre

Az Ubuntu NAT-olja (MASQUERADE)

A LAN eszk√∂z azt hiszi, hogy a k√©r√©s a 192.168.0.2-t≈ël j√∂tt

A v√°lasz visszamegy az Ubuntu-ra

Ubuntu visszak√ºldi a tunnelbe

üöÄ Alternat√≠v (jobb) megold√°s NAT n√©lk√ºl

Ha nem akarsz NAT-ot, akkor:

A routeren adj hozz√° statikus route-ot:

10.0.0.0/24 via 192.168.0.2

√çgy a LAN eszk√∂z√∂k tudni fogj√°k, hogy a 10.0.0.x h√°l√≥zat az Ubuntu fel√© √©rhet≈ë el.

Ez tiszt√°bb megold√°s, de nem minden router tud statikus route-ot.

üîé Gyors ellen≈ërz√©s

Tunnel fel√©p√ºl√©se ut√°n:

Ubuntu-n:

sudo wg show

Ping teszt:

Kliensr≈ël:

ping 192.168.0.1
ping 192.168.0.100
üéØ √ñsszefoglalva

A kulcs:

IP forwarding

FORWARD szab√°ly

NAT (ha nincs statikus route)

kliens oldalon AllowedIPs helyes be√°ll√≠t√°sa

Ha szeretn√©d, meg tudom √≠rni pontosan a teljes m≈±k√∂d≈ë configot a te IP c√≠meiddel.
Router t√≠pus√°t is meg√≠rhatod, mert az is sz√°m√≠that.
